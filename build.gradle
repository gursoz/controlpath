import com.parent.TridentBuild

project.defaultTasks 'mybuild'

@CacheableTask    
abstract class ControlpathBuild extends TridentBuild {
  Boolean forceBuild = null

  @InputDirectory
  abstract DirectoryProperty getBedrockSrcDir()


  public void doBuild() {
     project.exec {
        workingDir '.'
        commandLine './build/build.sh'
     }
  }

  @Option( option = 'force', description = 'Build even if not stale in cache. Will force build only this repo')
  void setForceBuild(final Boolean ignoreVal) {
     forceBuild = true
  }

  Map<String,String> getInputProperties() {
     def inputMap = [:]
     if(forceBuild==true) {
        inputMap['timestamp'] = LocalDateTime.now().toString()
     }
     return inputMap
  }

}

task mybuild(type: ControlpathBuild) {
    srcDir = file('/home/cyc/Test/learngit/gitmodule/parentrepo/controlpath/src')
    bedrockSrcDir = file('/home/cyc/Test/learngit/gitmodule/parentrepo/bedrock/src/')
    outputDir = file('./output')
    dependsOn ':bedrock:mybuild' 
   
}



